# æ•™å­¦æ¼”ç¤ºå·¥å…·å®ç°æ–¹æ¡ˆ

## é¡¹ç›®ç°çŠ¶åˆ†æ

### ç°æœ‰æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React 19.2.0 + React DOM
- **åç«¯**: Node.js + Express + MySQL
- **æ–‡ä»¶å¤„ç†**: å·²æ”¯æŒ PDF (pdfjs-dist 5.4.449)ã€PPT/PPTX è½¬æ¢
- **æ•°æ®åº“**: MySQL (å·²æœ‰ç”¨æˆ·ã€ä½œä¸šã€è¯¾ä»¶ç­‰è¡¨ç»“æ„)
- **æ–‡ä»¶å­˜å‚¨**: æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (uploadsç›®å½•)

### ç°æœ‰åŠŸèƒ½åŸºç¡€
âœ… **å·²å…·å¤‡çš„æ ¸å¿ƒèƒ½åŠ›**:
- ç”¨æˆ·è®¤è¯ç³»ç»Ÿ (æ•™å¸ˆ/å­¦ç”Ÿè§’è‰²)
- è¯¾ä»¶ä¸Šä¼ ä¸ç®¡ç† (æ”¯æŒPPTã€PDFã€DOCç­‰æ ¼å¼)
- PPTè½¬å›¾ç‰‡é¢„è§ˆåŠŸèƒ½ (ä½¿ç”¨LibreOffice + ImageMagick)
- PDFé¢„è§ˆåŠŸèƒ½ (pdfjs-dist)
- æ–‡ä»¶ä¸Šä¼ ä¸‹è½½ç³»ç»Ÿ
- ä½œä¸šç®¡ç†ç³»ç»Ÿ
- åœ¨çº¿ç­”ç–‘ç³»ç»Ÿ
- é€šçŸ¥ç³»ç»Ÿ

âŒ **ç¼ºå¤±çš„å…³é”®åŠŸèƒ½**:
- WebSocketå®æ—¶é€šä¿¡
- Canvasæ ‡æ³¨ç³»ç»Ÿ
- æŠ•ç¥¨ç³»ç»Ÿ
- çŸ¥è¯†ç‚¹é”šç‚¹ç®¡ç†
- æ¼”ç¤ºæ¨¡å¼ç•Œé¢
- è§†é¢‘æ’­æ”¾é›†æˆ
- ä»£ç ç¼–è¾‘å™¨é›†æˆ

## å®ç°æ–¹æ¡ˆ

### æ¨¡å—1: è¯¾ä»¶æ¼”ç¤ºæ ¸å¿ƒåŠŸèƒ½

#### 1.1 æ¼”ç¤ºç•Œé¢é‡æ„
```javascript
// æ–°å¢ç»„ä»¶: src/components/PresentationMode.js
const PresentationMode = ({ coursewareId, anchors, onExit }) => {
  const [currentSlide, setCurrentSlide] = useState(0);
  const [slides, setSlides] = useState([]);
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [teacherNotes, setTeacherNotes] = useState('');
  
  // è¯¾ä»¶åŠ è½½é€»è¾‘
  // å…¨å±æ§åˆ¶
  // ç¿»é¡µæ§åˆ¶ (é”®ç›˜/é¼ æ ‡)
  // è¿›åº¦æ¡æ˜¾ç¤º
  // å¤‡æ³¨æ  (ä»…æ•™å¸ˆå¯è§)
}
```

**å®ç°æ­¥éª¤**:
1. æ‰©å±•ç°æœ‰çš„è¯¾ä»¶é¢„è§ˆAPIï¼Œæ”¯æŒæ¼”ç¤ºæ¨¡å¼
2. æ–°å¢å…¨å±æ¼”ç¤ºç»„ä»¶
3. é›†æˆé”®ç›˜å¿«æ·é”®æ§åˆ¶ (â†â†’ ç¿»é¡µ, ESCé€€å‡º)
4. æ·»åŠ è¿›åº¦æ¡å’Œé¡µç æ˜¾ç¤º

#### 1.2 çŸ¥è¯†ç‚¹é”šç‚¹ç³»ç»Ÿ
```sql
-- æ–°å¢æ•°æ®è¡¨
CREATE TABLE knowledge_anchors (
  id INT PRIMARY KEY AUTO_INCREMENT,
  courseware_id INT NOT NULL,
  slide_number INT NOT NULL,
  anchor_name VARCHAR(100) NOT NULL,
  description TEXT,
  x_position DECIMAL(5,2), -- é”šç‚¹åœ¨å¹»ç¯ç‰‡ä¸­çš„Xåæ ‡(ç™¾åˆ†æ¯”)
  y_position DECIMAL(5,2), -- é”šç‚¹åœ¨å¹»ç¯ç‰‡ä¸­çš„Yåæ ‡(ç™¾åˆ†æ¯”)
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (courseware_id) REFERENCES courseware(id)
);

CREATE TABLE anchor_resources (
  id INT PRIMARY KEY AUTO_INCREMENT,
  anchor_id INT NOT NULL,
  resource_type ENUM('video', 'code', 'syntax') NOT NULL,
  resource_url VARCHAR(500), -- Bç«™é“¾æ¥æˆ–å†…éƒ¨èµ„æºè·¯å¾„
  resource_content TEXT, -- ä»£ç å†…å®¹æˆ–è¯­æ³•è¯´æ˜
  title VARCHAR(200),
  description TEXT,
  FOREIGN KEY (anchor_id) REFERENCES knowledge_anchors(id)
);
```

**APIæ¥å£è®¾è®¡**:
```javascript
// backend/routes/anchors.js
app.get('/api/courseware/:id/anchors', async (req, res) => {
  // è·å–è¯¾ä»¶çš„æ‰€æœ‰çŸ¥è¯†ç‚¹é”šç‚¹
});

app.post('/api/anchors', async (req, res) => {
  // åˆ›å»ºæ–°çš„çŸ¥è¯†ç‚¹é”šç‚¹
});

app.post('/api/anchors/:id/resources', async (req, res) => {
  // ä¸ºé”šç‚¹æ·»åŠ å…³è”èµ„æº
});
```

### æ¨¡å—2: å®æ—¶äº’åŠ¨ç³»ç»Ÿ

#### 2.1 WebSocketé›†æˆ
```bash
# å®‰è£…ä¾èµ–
cd backend
npm install socket.io
npm install redis  # ç”¨äºæŠ•ç¥¨æ•°æ®å­˜å‚¨
```

```javascript
// backend/socket.js - æ–°å»ºæ–‡ä»¶
const { Server } = require('socket.io');
const redis = require('redis');

class PresentationSocket {
  constructor(server) {
    this.io = new Server(server, {
      cors: { origin: "http://localhost:3000" }
    });
    this.redisClient = redis.createClient();
    this.setupEventHandlers();
  }
  
  setupEventHandlers() {
    this.io.on('connection', (socket) => {
      // åŠ å…¥æ¼”ç¤ºæˆ¿é—´
      socket.on('join-presentation', (data) => {
        const { coursewareId, userRole, userId } = data;
        socket.join(`presentation-${coursewareId}`);
        socket.userRole = userRole;
        socket.userId = userId;
      });
      
      // æ•™å¸ˆå‘èµ·æŠ•ç¥¨
      socket.on('start-vote', async (voteData) => {
        if (socket.userRole === 'teacher') {
          await this.createVote(voteData);
          socket.to(`presentation-${voteData.coursewareId}`)
                .emit('vote-started', voteData);
        }
      });
      
      // å­¦ç”ŸæŠ•ç¥¨
      socket.on('submit-vote', async (voteSubmission) => {
        await this.recordVote(voteSubmission);
        const results = await this.getVoteResults(voteSubmission.voteId);
        this.io.to(`presentation-${voteSubmission.coursewareId}`)
             .emit('vote-updated', results);
      });
      
      // å®æ—¶æ ‡æ³¨åŒæ­¥
      socket.on('annotation', (annotationData) => {
        if (socket.userRole === 'teacher') {
          socket.to(`presentation-${annotationData.coursewareId}`)
                .emit('annotation-update', annotationData);
        }
      });
    });
  }
}
```

#### 2.2 Canvasæ ‡æ³¨ç³»ç»Ÿ
```javascript
// src/components/AnnotationCanvas.js
const AnnotationCanvas = ({ slideImage, isTeacher, onAnnotationChange }) => {
  const canvasRef = useRef(null);
  const [isDrawing, setIsDrawing] = useState(false);
  const [annotations, setAnnotations] = useState([]);
  const [currentTool, setCurrentTool] = useState('pen'); // pen, highlighter, eraser
  const [currentColor, setCurrentColor] = useState('#ff0000');
  const [currentWidth, setCurrentWidth] = useState(3);
  
  const startDrawing = (e) => {
    if (!isTeacher) return;
    setIsDrawing(true);
    const rect = canvasRef.current.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    // å¼€å§‹ç»˜åˆ¶é€»è¾‘
  };
  
  const draw = (e) => {
    if (!isDrawing || !isTeacher) return;
    // ç»˜åˆ¶é€»è¾‘
    // å®æ—¶å‘é€æ ‡æ³¨æ•°æ®åˆ°WebSocket
  };
  
  const stopDrawing = () => {
    setIsDrawing(false);
    // ä¿å­˜æ ‡æ³¨æ•°æ®
  };
  
  return (
    <div className="annotation-container">
      <canvas
        ref={canvasRef}
        onMouseDown={startDrawing}
        onMouseMove={draw}
        onMouseUp={stopDrawing}
        style={{ position: 'absolute', top: 0, left: 0, zIndex: 10 }}
      />
      {isTeacher && (
        <div className="annotation-toolbar">
          <button onClick={() => setCurrentTool('pen')}>ç”»ç¬”</button>
          <button onClick={() => setCurrentTool('highlighter')}>è§å…‰ç¬”</button>
          <button onClick={() => setCurrentTool('eraser')}>æ©¡çš®æ“¦</button>
          <input 
            type="color" 
            value={currentColor} 
            onChange={(e) => setCurrentColor(e.target.value)} 
          />
          <input 
            type="range" 
            min="1" 
            max="10" 
            value={currentWidth}
            onChange={(e) => setCurrentWidth(e.target.value)} 
          />
        </div>
      )}
    </div>
  );
};
```

#### 2.3 æŠ•ç¥¨ç³»ç»Ÿ
```javascript
// src/components/VotingSystem.js
const VotingSystem = ({ coursewareId, userRole, userId }) => {
  const [currentVote, setCurrentVote] = useState(null);
  const [voteResults, setVoteResults] = useState(null);
  const [hasVoted, setHasVoted] = useState(false);
  
  const startVote = (voteConfig) => {
    const voteData = {
      coursewareId,
      question: voteConfig.question,
      options: voteConfig.options,
      duration: voteConfig.duration,
      voteId: Date.now()
    };
    
    socket.emit('start-vote', voteData);
    setCurrentVote(voteData);
  };
  
  const submitVote = (selectedOption) => {
    socket.emit('submit-vote', {
      voteId: currentVote.voteId,
      coursewareId,
      userId,
      selectedOption
    });
    setHasVoted(true);
  };
  
  return (
    <div className="voting-system">
      {userRole === 'teacher' && (
        <VoteCreator onStartVote={startVote} />
      )}
      
      {currentVote && !hasVoted && userRole === 'student' && (
        <VoteParticipant 
          vote={currentVote} 
          onSubmit={submitVote} 
        />
      )}
      
      {voteResults && (
        <VoteResults results={voteResults} />
      )}
    </div>
  );
};
```

### æ¨¡å—3: çŸ¥è¯†ç‚¹è·³è½¬é—­ç¯

#### 3.1 è·³è½¬ç®¡ç†ç³»ç»Ÿ
```javascript
// src/utils/NavigationManager.js
class NavigationManager {
  static saveCurrentPosition(coursewareId, slideNumber) {
    localStorage.setItem('presentation-position', JSON.stringify({
      coursewareId,
      slideNumber,
      timestamp: Date.now()
    }));
  }
  
  static getReturnPosition() {
    const saved = localStorage.getItem('presentation-position');
    return saved ? JSON.parse(saved) : null;
  }
  
  static clearReturnPosition() {
    localStorage.removeItem('presentation-position');
  }
}
```

#### 3.2 èµ„æºé¡µé¢ç»„ä»¶
```javascript
// src/components/ResourceViewer.js
const ResourceViewer = ({ resource, onReturn }) => {
  const returnPosition = NavigationManager.getReturnPosition();
  
  const handleReturn = () => {
    NavigationManager.clearReturnPosition();
    onReturn(returnPosition);
  };
  
  return (
    <div className="resource-viewer">
      <div className="return-bar">
        <button onClick={handleReturn} className="return-btn">
          â† è¿”å›æ¼”ç¤º (ç¬¬{returnPosition?.slideNumber}é¡µ)
        </button>
      </div>
      
      <div className="resource-content">
        {resource.type === 'video' && (
          <VideoPlayer url={resource.url} />
        )}
        {resource.type === 'code' && (
          <CodeEditor 
            initialCode={resource.content}
            language={resource.language}
            runnable={true}
          />
        )}
        {resource.type === 'syntax' && (
          <SyntaxExplainer content={resource.content} />
        )}
      </div>
    </div>
  );
};
```

## æ•°æ®åº“æ‰©å±•

### æ–°å¢è¡¨ç»“æ„
```sql
-- æ¼”ç¤ºä¼šè¯è¡¨
CREATE TABLE presentation_sessions (
  id INT PRIMARY KEY AUTO_INCREMENT,
  courseware_id INT NOT NULL,
  teacher_id INT NOT NULL,
  session_name VARCHAR(200),
  start_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  end_time TIMESTAMP NULL,
  status ENUM('active', 'paused', 'ended') DEFAULT 'active',
  current_slide INT DEFAULT 1,
  FOREIGN KEY (courseware_id) REFERENCES courseware(id)
);

-- æŠ•ç¥¨è®°å½•è¡¨
CREATE TABLE presentation_votes (
  id INT PRIMARY KEY AUTO_INCREMENT,
  session_id INT NOT NULL,
  question TEXT NOT NULL,
  options JSON NOT NULL, -- å­˜å‚¨é€‰é¡¹æ•°ç»„
  duration INT DEFAULT 30, -- æŠ•ç¥¨æ—¶é•¿(ç§’)
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  ended_at TIMESTAMP NULL,
  FOREIGN KEY (session_id) REFERENCES presentation_sessions(id)
);

-- æŠ•ç¥¨ç»“æœè¡¨
CREATE TABLE vote_submissions (
  id INT PRIMARY KEY AUTO_INCREMENT,
  vote_id INT NOT NULL,
  student_id VARCHAR(50) NOT NULL,
  selected_option INT NOT NULL,
  submitted_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (vote_id) REFERENCES presentation_votes(id)
);

-- æ ‡æ³¨è®°å½•è¡¨
CREATE TABLE presentation_annotations (
  id INT PRIMARY KEY AUTO_INCREMENT,
  session_id INT NOT NULL,
  slide_number INT NOT NULL,
  annotation_data JSON NOT NULL, -- å­˜å‚¨Canvasç»˜åˆ¶æ•°æ®
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (session_id) REFERENCES presentation_sessions(id)
);
```

## å‰ç«¯ä¾èµ–æ‰©å±•

### éœ€è¦å®‰è£…çš„åŒ…
```json
{
  "dependencies": {
    "socket.io-client": "^4.7.4",
    "react-player": "^2.13.0",
    "monaco-editor": "^0.44.0",
    "@monaco-editor/react": "^4.6.0",
    "fabric": "^5.3.0",
    "chart.js": "^4.4.0",
    "react-chartjs-2": "^5.2.0"
  }
}
```

## å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µ (1-2å‘¨): åŸºç¡€æ¼”ç¤ºåŠŸèƒ½
1. âœ… åˆ©ç”¨ç°æœ‰PPTè½¬å›¾ç‰‡åŠŸèƒ½
2. ğŸ”§ å¼€å‘æ¼”ç¤ºæ¨¡å¼ç•Œé¢
3. ğŸ”§ å®ç°å…¨å±æ’­æ”¾å’Œç¿»é¡µæ§åˆ¶
4. ğŸ”§ æ·»åŠ æ•™å¸ˆå¤‡æ³¨æ 

### ç¬¬äºŒé˜¶æ®µ (2-3å‘¨): çŸ¥è¯†ç‚¹é”šç‚¹ç³»ç»Ÿ
1. ğŸ”§ è®¾è®¡å¹¶åˆ›å»ºé”šç‚¹ç›¸å…³æ•°æ®è¡¨
2. ğŸ”§ å¼€å‘é”šç‚¹æ ‡è®°ç•Œé¢ (æ•™å¸ˆç«¯)
3. ğŸ”§ å®ç°èµ„æºå…³è”åŠŸèƒ½
4. ğŸ”§ å¼€å‘è·³è½¬é—­ç¯é€»è¾‘

### ç¬¬ä¸‰é˜¶æ®µ (3-4å‘¨): å®æ—¶äº’åŠ¨åŠŸèƒ½
1. ğŸ”§ é›†æˆSocket.IOåˆ°åç«¯
2. ğŸ”§ å¼€å‘Canvasæ ‡æ³¨ç³»ç»Ÿ
3. ğŸ”§ å®ç°æŠ•ç¥¨ç³»ç»Ÿ
4. ğŸ”§ æ·»åŠ Redisç¼“å­˜æ”¯æŒ

### ç¬¬å››é˜¶æ®µ (1å‘¨): é›†æˆæµ‹è¯•ä¸ä¼˜åŒ–
1. ğŸ”§ ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•
2. ğŸ”§ æ€§èƒ½ä¼˜åŒ–
3. ğŸ”§ ç”¨æˆ·ä½“éªŒä¼˜åŒ–
4. ğŸ”§ æ–‡æ¡£å®Œå–„

## æŠ€æœ¯é£é™©ä¸è§£å†³æ–¹æ¡ˆ

### é£é™©1: WebSocketè¿æ¥ç¨³å®šæ€§
**è§£å†³æ–¹æ¡ˆ**: 
- å®ç°è‡ªåŠ¨é‡è¿æœºåˆ¶
- æ·»åŠ å¿ƒè·³æ£€æµ‹
- æä¾›ç¦»çº¿æ¨¡å¼é™çº§

### é£é™©2: Canvasæ ‡æ³¨æ€§èƒ½
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨Fabric.jsä¼˜åŒ–Canvasæ“ä½œ
- å®ç°æ ‡æ³¨æ•°æ®å‹ç¼©
- æ·»åŠ æ ‡æ³¨å†å²ç®¡ç†

### é£é™©3: å¤šç”¨æˆ·å¹¶å‘
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨Redisç®¡ç†ä¼šè¯çŠ¶æ€
- å®ç°æˆ¿é—´éš”ç¦»æœºåˆ¶
- æ·»åŠ ç”¨æˆ·åœ¨çº¿çŠ¶æ€ç®¡ç†

## é¢„æœŸæ•ˆæœ

### æ•™å­¦æ•ˆæœæå‡
- **äº’åŠ¨å‚ä¸åº¦**: é¢„è®¡æå‡60%ä»¥ä¸Š
- **çŸ¥è¯†ç‚¹ç†è§£**: é€šè¿‡æŠ•ç¥¨å®æ—¶åé¦ˆï¼ŒåŠæ—¶è°ƒæ•´æ•™å­¦èŠ‚å¥
- **æ³¨æ„åŠ›é›†ä¸­**: æ ‡æ³¨åŠŸèƒ½æ›¿ä»£ä¼ ç»Ÿæ¿ä¹¦ï¼Œå­¦ç”Ÿä¸“æ³¨åº¦æå‡

### æŠ€æœ¯æŒ‡æ ‡
- **å“åº”å»¶è¿Ÿ**: WebSocketé€šä¿¡å»¶è¿Ÿ < 100ms
- **å¹¶å‘æ”¯æŒ**: å•ä¸ªæ¼”ç¤ºä¼šè¯æ”¯æŒ100+å­¦ç”ŸåŒæ—¶åœ¨çº¿
- **ç³»ç»Ÿç¨³å®šæ€§**: 99%ä»¥ä¸Šçš„è¿æ¥æˆåŠŸç‡

## æ€»ç»“

ç°æœ‰é¡¹ç›®å·²å…·å¤‡è‰¯å¥½çš„åŸºç¡€æ¶æ„ï¼Œç‰¹åˆ«æ˜¯è¯¾ä»¶ç®¡ç†å’Œç”¨æˆ·ç³»ç»Ÿå·²ç»å®Œå–„ã€‚ä¸»è¦éœ€è¦è¡¥å……çš„æ˜¯å®æ—¶é€šä¿¡èƒ½åŠ›å’Œäº¤äº’åŠŸèƒ½ã€‚é€šè¿‡åˆ†é˜¶æ®µå®æ–½ï¼Œå¯ä»¥åœ¨ç°æœ‰åŸºç¡€ä¸Šå¿«é€Ÿæ„å»ºå‡ºå®Œæ•´çš„æ•™å­¦æ¼”ç¤ºå·¥å…·ï¼Œå®ç°æ²‰æµ¸å¼æ•™å­¦ä½“éªŒã€‚

å…³é”®æˆåŠŸå› ç´ :
1. å……åˆ†åˆ©ç”¨ç°æœ‰çš„PPTè½¬æ¢å’ŒPDFé¢„è§ˆèƒ½åŠ›
2. åˆç†è®¾è®¡WebSocketé€šä¿¡æ¶æ„
3. ä¼˜åŒ–Canvasæ ‡æ³¨çš„ç”¨æˆ·ä½“éªŒ
4. ç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œæ‰©å±•æ€§