# ğŸš€ æœåŠ¡å™¨éƒ¨ç½²å‰©ä½™æ­¥éª¤

## ğŸ“‹ å‰ææ¡ä»¶
- âœ… é¡¹ç›®å·²å®Œæ•´ä¸Šä¼ åˆ°æœåŠ¡å™¨
- âœ… ä¿æŒç°æœ‰é¡¹ç›®æ¶æ„ä¸å˜
- âœ… ä½¿ç”¨ç°æœ‰æ•°æ®åº“é…ç½®
- âœ… æ— åŸŸåï¼Œä½¿ç”¨IPè®¿é—®

## ğŸ¯ å‰©ä½™æ­¥éª¤ (æŒ‰é¡ºåºæ‰§è¡Œ)

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…Node.jsä¾èµ–

#### 1.1 å®‰è£…åç«¯ä¾èµ–
```cmd
# è¿›å…¥åç«¯ç›®å½•
cd backend
npm install

# å¦‚æœæœ‰æƒé™é—®é¢˜ï¼Œä½¿ç”¨ç®¡ç†å‘˜æƒé™
```

#### 1.2 å®‰è£…å‰ç«¯ä¾èµ–
```cmd
# å›åˆ°é¡¹ç›®æ ¹ç›®å½•
cd ..
npm install
```

### ç¬¬äºŒæ­¥ï¼šæ„å»ºå‰ç«¯é¡¹ç›®

```cmd
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
npm run build
```

è¿™ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ç”Ÿæˆ `build` æ–‡ä»¶å¤¹ï¼ŒåŒ…å«æ‰€æœ‰å‰ç«¯é™æ€æ–‡ä»¶ã€‚

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£…PM2è¿›ç¨‹ç®¡ç†å™¨

```cmd
# å…¨å±€å®‰è£…PM2
npm install -g pm2
```

### ç¬¬å››æ­¥ï¼šå¯åŠ¨åç«¯æœåŠ¡

#### 4.1 ç›´æ¥å¯åŠ¨ (æµ‹è¯•ç”¨)
```cmd
cd backend
node index.js
```

#### 4.2 ä½¿ç”¨PM2å¯åŠ¨ (æ¨è)
```cmd
# åœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»ºPM2é…ç½®æ–‡ä»¶
# åˆ›å»º ecosystem.config.js
```

åˆ›å»º `ecosystem.config.js` æ–‡ä»¶ï¼š
```javascript
module.exports = {
  apps: [{
    name: 'js-editor-backend',
    script: './backend/index.js',
    instances: 1,
    autorestart: true,
    watch: false,
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production',
      PORT: 5000
    }
  }]
};
```

å¯åŠ¨æœåŠ¡ï¼š
```cmd
pm2 start ecosystem.config.js
pm2 save
pm2 startup
```

### ç¬¬äº”æ­¥ï¼šé…ç½®WebæœåŠ¡å™¨ (IIS)

#### 5.1 å®‰è£…IISå’Œå¿…è¦æ¨¡å—
1. æ‰“å¼€"æ§åˆ¶é¢æ¿" â†’ "ç¨‹åº" â†’ "å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½"
2. å‹¾é€‰"Internet Information Services"
3. å®‰è£…URL Rewriteæ¨¡å— (ä»å¾®è½¯å®˜ç½‘ä¸‹è½½)

#### 5.2 åˆ›å»ºIISç½‘ç«™
1. æ‰“å¼€IISç®¡ç†å™¨
2. å³é”®"ç½‘ç«™" â†’ "æ·»åŠ ç½‘ç«™"
3. é…ç½®å¦‚ä¸‹ï¼š
   - ç½‘ç«™åç§°: `JS-Editor`
   - ç‰©ç†è·¯å¾„: `ä½ çš„é¡¹ç›®è·¯å¾„\build`
   - ç«¯å£: `80`

#### 5.3 é…ç½®web.config
åœ¨ `build` ç›®å½•ä¸‹åˆ›å»º `web.config` æ–‡ä»¶ï¼š
```xml
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
  <system.webServer>
    <rewrite>
      <rules>
        <!-- APIä»£ç† -->
        <rule name="API Proxy" stopProcessing="true">
          <match url="^api/(.*)" />
          <action type="Rewrite" url="http://localhost:5000/api/{R:1}" />
        </rule>
        
        <!-- é™æ€èµ„æºä»£ç† -->
        <rule name="Static Proxy" stopProcessing="true">
          <match url="^uploads/(.*)" />
          <action type="Rewrite" url="http://localhost:5000/uploads/{R:1}" />
        </rule>
        
        <!-- React Routeræ”¯æŒ -->
        <rule name="React Router" stopProcessing="true">
          <match url=".*" />
          <conditions logicalGrouping="MatchAll">
            <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
            <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
            <add input="{REQUEST_URI}" pattern="^/(api|uploads)" negate="true" />
          </conditions>
          <action type="Rewrite" url="/" />
        </rule>
      </rules>
    </rewrite>
  </system.webServer>
</configuration>
```

### ç¬¬å…­æ­¥ï¼šåˆå§‹åŒ–æ•°æ®åº“è¡¨ (å¦‚æœéœ€è¦)

```cmd
cd backend
node init-anchor-tables.js
```

### ç¬¬ä¸ƒæ­¥ï¼šé…ç½®é˜²ç«å¢™

```cmd
# å…è®¸HTTPè®¿é—®
netsh advfirewall firewall add rule name="HTTP" dir=in action=allow protocol=TCP localport=80

# å…è®¸åç«¯APIè®¿é—® (å¦‚æœéœ€è¦å¤–éƒ¨ç›´æ¥è®¿é—®)
netsh advfirewall firewall add rule name="Node API" dir=in action=allow protocol=TCP localport=5000
```

### ç¬¬å…«æ­¥ï¼šæµ‹è¯•ç³»ç»Ÿ

#### 8.1 æ£€æŸ¥åç«¯æœåŠ¡
```cmd
# æ£€æŸ¥PM2çŠ¶æ€
pm2 list

# æµ‹è¯•API
curl http://localhost:5000
# æˆ–åœ¨æµè§ˆå™¨è®¿é—® http://localhost:5000
```

#### 8.2 æ£€æŸ¥å‰ç«¯è®¿é—®
åœ¨æµè§ˆå™¨è®¿é—®ï¼š
- `http://æœåŠ¡å™¨IP` (é€šè¿‡IIS)
- `http://localhost` (åœ¨æœåŠ¡å™¨æœ¬åœ°)

### ç¬¬ä¹æ­¥ï¼šåˆ›å»ºå¿…è¦ç›®å½•

```cmd
# ç¡®ä¿ä¸Šä¼ ç›®å½•å­˜åœ¨
cd backend
mkdir uploads\courseware
mkdir uploads\videos  
mkdir uploads\ppt-images
mkdir uploads\submissions
```

## ğŸ”§ å¿«é€Ÿå¯åŠ¨è„šæœ¬

åˆ›å»º `start-server.bat` æ–‡ä»¶ï¼š
```batch
@echo off
echo å¯åŠ¨JSç¼–è¾‘å™¨ç³»ç»Ÿ...

echo 1. å¯åŠ¨åç«¯æœåŠ¡...
pm2 start ecosystem.config.js

echo 2. å¯åŠ¨IIS...
iisreset /start

echo 3. æ£€æŸ¥æœåŠ¡çŠ¶æ€...
pm2 list

echo ç³»ç»Ÿå¯åŠ¨å®Œæˆï¼
echo è®¿é—®åœ°å€: http://localhost
pause
```

## ğŸ› ï¸ å¸¸ç”¨ç®¡ç†å‘½ä»¤

```cmd
# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs js-editor-backend

# é‡å¯åç«¯æœåŠ¡
pm2 restart js-editor-backend

# åœæ­¢åç«¯æœåŠ¡
pm2 stop js-editor-backend

# é‡å¯IIS
iisreset

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -ano | findstr :5000
netstat -ano | findstr :80
```

## ğŸ¯ è®¿é—®åœ°å€

éƒ¨ç½²å®Œæˆåçš„è®¿é—®åœ°å€ï¼š
- **å‰ç«¯åº”ç”¨**: `http://æœåŠ¡å™¨IP`
- **åç«¯API**: `http://æœåŠ¡å™¨IP:5000` (å¦‚æœå¼€æ”¾äº†5000ç«¯å£)
- **æœ¬åœ°æµ‹è¯•**: `http://localhost`

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ**
2. **æ£€æŸ¥backend/.envæ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®**
3. **å¦‚æœ5000ç«¯å£è¢«å ç”¨ï¼Œä¿®æ”¹backend/index.jsä¸­çš„PORT**
4. **ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ç”¨äºæ–‡ä»¶ä¸Šä¼ **
5. **LibreOfficeå’ŒImageMagickéœ€è¦å•ç‹¬å®‰è£…ç”¨äºPPTè½¬æ¢**

## ğŸš¨ æ•…éšœæ’é™¤

### åç«¯å¯åŠ¨å¤±è´¥
```cmd
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
cd backend
node index.js
```

### å‰ç«¯æ— æ³•è®¿é—®
1. æ£€æŸ¥IISæ˜¯å¦æ­£å¸¸è¿è¡Œ
2. æ£€æŸ¥web.configé…ç½®æ˜¯å¦æ­£ç¡®
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### APIè°ƒç”¨å¤±è´¥
1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ: `pm2 list`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨: `netstat -ano | findstr :5000`
3. æ£€æŸ¥æ•°æ®åº“è¿æ¥æ˜¯å¦æ­£å¸¸

---

æŒ‰ç…§è¿™äº›æ­¥éª¤æ“ä½œï¼Œä½ çš„ç³»ç»Ÿå°±èƒ½æ­£å¸¸è¿è¡Œäº†ï¼ğŸ‰